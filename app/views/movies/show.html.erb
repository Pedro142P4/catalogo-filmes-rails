<h1><%= @movie.title %></h1>

<% if @movie.poster.attached? %>
  <div style="margin-bottom: 20px;">
    <%= image_tag @movie.poster, style: "width: 300px; height: auto; border-radius: 8px;" %>
  </div>
<% end %>

<p><strong>Diretor:</strong> <%= @movie.director %></p>
<p><strong>Ano de Lançamento:</strong> <%= @movie.release_year %></p>
<p><strong>Duração:</strong> <%= @movie.duration %> minutos</p>

<div class="category-list">
  <% @movie.categories.each do |category| %>
    <span class="category-tag"><%= category.name %></span>
  <% end %>
</div>

<div class="category-list" style="margin-top: 10px;"> <% @movie.tags.each do |tag| %>
    <span class="category-tag"><%= tag.name %></span> 
  <% end %>
</div>
<hr>
<h3>Sinopse</h3>
<p><%= @movie.synopsis %></p>

<hr>

<% if user_signed_in? && @movie.user == current_user %>

  <div class="button-group">

    <%= link_to "Editar este filme", edit_movie_path(@movie), class: "button" %>

    <%= button_to "Apagar este filme", 
                  movie_path(@movie), 
                  method: :delete, 
                  class: "button-danger",
                  data: { confirm: "Tem certeza que deseja apagar este filme?" } %>

  </div>

<% end %>

<hr>

<h3>Adicionar um Comentário</h3>

<%= form_with model: [@movie, @comment] do |form| %>
  
  <% unless user_signed_in? %>
    <div class="field">
      <%= form.label :name, "Seu Nome" %><br>
      <%= form.text_field :name %>
    </div>
  <% else %>
    <p>Comentando como: <strong><%= current_user.email %></strong></p>
  <% end %>

  <div class="field">
    <%= form.label :content, "Comentário" %><br>
    <%= form.text_area :content, rows: 4 %>
  </div>

  <div class="actions">
    <%= form.submit "Enviar Comentário" %>
  </div>
<% end %>

<hr>

<h3>Comentários</h3>

<div id="comments">
  <% if @comments.empty? %>
    <p>Ainda não há comentários. Seja o primeiro!</p>
  <% end %>

  <% @comments.each do |comment| %>
    <div class="comment">
      <p>
        <strong>
          <% if comment.user.present? %>
            <%= comment.user.email %>
          <% else %>
            <%= comment.name %>
          <% end %>
        </strong>
        <span style="color: #555; font-size: 0.8em;">
          <%= time_ago_in_words(comment.created_at) %> atrás
        </span>
      </p>
      <p><%= comment.content %></p>
    </div>
    <hr>
  <% end %>
</div>


<br>
<%= link_to "Voltar para a lista", root_path, class: "button" %>